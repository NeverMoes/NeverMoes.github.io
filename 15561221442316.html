<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  ZooKeeper - ZAB 一致性协议 - NeverMoes 的笔记
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="NeverMoes 的笔记" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">NeverMoes 的笔记</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; NeverMoes 的笔记</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>Java</label></li>

          
            <li><a title="Java - 编码" href="15613569036612.html">Java - 编码</a></li>
          
            <li><a title="Java - Log" href="15594642382768.html">Java - Log</a></li>
          
            <li><a title="Java - 异常处理" href="15594627836663.html">Java - 异常处理</a></li>
          
            <li><a title="Java - Steam" href="15584212270447.html">Java - Steam</a></li>
          
            <li><a title="Java - 反射" href="15580921637682.html">Java - 反射</a></li>
          
            <li><a title="Java - Enum" href="15580808809919.html">Java - Enum</a></li>
          
            <li><a title="Javadoc" href="15573232964198.html">Javadoc</a></li>
          
            <li><a title="编程规范" href="15573214224993.html">编程规范</a></li>
          
            <li><a title="Java8" href="15571102853200.html">Java8</a></li>
          
            <li><a title="一些特性" href="15568697463497.html">一些特性</a></li>
          
            <li><a title="Java 补充" href="15557361529750.html">Java 补充</a></li>
          
            <li><a title="Java 基础" href="15554689517828.html">Java 基础</a></li>
          
            <li><a title="Java - IO" href="15551380554375.html">Java - IO</a></li>
          
            <li><a title="Java 经典设计模式" href="15548114065751.html">Java 经典设计模式</a></li>
          
            <li><a title="常用设计模式" href="15547272355117.html">常用设计模式</a></li>
          
            <li><a title="Java - 流(Stream)" href="15535872722415.html">Java - 流(Stream)</a></li>
          

      
        <li class="divider"></li>
        <li><label>Java 集合</label></li>

          
            <li><a title="Java 集合 - List" href="15619627957699.html">Java 集合 - List</a></li>
          
            <li><a title="Java - 集合框架" href="15557398305311.html">Java - 集合框架</a></li>
          

      
        <li class="divider"></li>
        <li><label>并发</label></li>

          
            <li><a title="Java 并发 - 同步器框架 AQS" href="15628279381258.html">Java 并发 - 同步器框架 AQS</a></li>
          
            <li><a title="Java 并发 - volatile 与 Java 内存模型(JMM)" href="15628250952791.html">Java 并发 - volatile 与 Java 内存模型(JMM)</a></li>
          
            <li><a title="Java 并发 - 生产者消费者模型" href="15551273585518.html">Java 并发 - 生产者消费者模型</a></li>
          
            <li><a title="Java 并发 - atomic" href="15551259864059.html">Java 并发 - atomic</a></li>
          
            <li><a title="Java 并发 - 线程池" href="15550409896106.html">Java 并发 - 线程池</a></li>
          
            <li><a title="Java 并发 - 常见并发容器" href="15549779705652.html">Java 并发 - 常见并发容器</a></li>
          
            <li><a title="Java 并发 - final 重排" href="15549631305867.html">Java 并发 - final 重排</a></li>
          
            <li><a title="Java 并发 - synchronized" href="15549492034730.html">Java 并发 - synchronized</a></li>
          
            <li><a title="Java 并发 - 线程" href="15549491562348.html">Java 并发 - 线程</a></li>
          
            <li><a title="Java 并发 - 常用同步器" href="15549094953523.html">Java 并发 - 常用同步器</a></li>
          
            <li><a title="Java 并发 - 概览" href="15536711259128.html">Java 并发 - 概览</a></li>
          

      
        <li class="divider"></li>
        <li><label>JVM</label></li>

          
            <li><a title="Java JVM - 分析工具" href="15592858144445.html">Java JVM - 分析工具</a></li>
          
            <li><a title="Java JVM - 类加载" href="15554954352575.html">Java JVM - 类加载</a></li>
          
            <li><a title="Java JVM - GC" href="15551422971585.html">Java JVM - GC</a></li>
          
            <li><a title="Java JVM - 内存布局" href="15551417067858.html">Java JVM - 内存布局</a></li>
          

      
        <li class="divider"></li>
        <li><label>Spring</label></li>

          
            <li><a title="Mybatis" href="15627234169476.html">Mybatis</a></li>
          
            <li><a title="Spring -  自定义标签" href="15580023414897.html">Spring -  自定义标签</a></li>
          
            <li><a title="Java - Servlet" href="15555575014317.html">Java - Servlet</a></li>
          
            <li><a title="Spring - 数据访问" href="15553337118605.html">Spring - 数据访问</a></li>
          
            <li><a title="spring 异步线程池" href="15546347724247.html">spring 异步线程池</a></li>
          
            <li><a title="Spring MVC" href="15546192348918.html">Spring MVC</a></li>
          
            <li><a title="Spring 事务" href="15544558066181.html">Spring 事务</a></li>
          
            <li><a title="Spring AOP" href="15543917219955.html">Spring AOP</a></li>
          
            <li><a title="Spring IoC" href="15543630452997.html">Spring IoC</a></li>
          

      
        <li class="divider"></li>
        <li><label>源码</label></li>

          
            <li><a title="源码" href="15627233586740.html">源码</a></li>
          

      
        <li class="divider"></li>
        <li><label>Redis</label></li>

          
            <li><a title="Redis 实现分布式锁" href="15565438727155.html">Redis 实现分布式锁</a></li>
          
            <li><a title="Redis 深入 - 双写一致性" href="15560904222673.html">Redis 深入 - 双写一致性</a></li>
          
            <li><a title="Redis 深入 - 高可用性" href="15560904056716.html">Redis 深入 - 高可用性</a></li>
          
            <li><a title="Redis 深入 - 数据结构" href="15560812001633.html">Redis 深入 - 数据结构</a></li>
          
            <li><a title="Redis 深入 - 常见问题" href="15556760212710.html">Redis 深入 - 常见问题</a></li>
          
            <li><a title="Redis 基本使用" href="15542783465338.html">Redis 基本使用</a></li>
          

      
        <li class="divider"></li>
        <li><label>Mysql</label></li>

          
            <li><a title="Mysql - 键、索引、约束" href="15633466729778.html">Mysql - 键、索引、约束</a></li>
          
            <li><a title="Mysql - 性能优化" href="15633423972144.html">Mysql - 性能优化</a></li>
          
            <li><a title="索引中的树 - B,B+,B*" href="15633420860231.html">索引中的树 - B,B+,B*</a></li>
          
            <li><a title="性能优化" href="15607574336137.html">性能优化</a></li>
          
            <li><a title="Mysql - EXPLAIN" href="15607559623364.html">Mysql - EXPLAIN</a></li>
          
            <li><a title="Mysql 深入" href="15555007777074.html">Mysql 深入</a></li>
          
            <li><a title="Mysql 基本使用" href="15554985061309.html">Mysql 基本使用</a></li>
          

      
        <li class="divider"></li>
        <li><label>消息队列</label></li>

          
            <li><a title="JMS" href="15584265544434.html">JMS</a></li>
          
            <li><a title="RPC - RMI" href="15572232721703.html">RPC - RMI</a></li>
          
            <li><a title="消息队列" href="15560753193297.html">消息队列</a></li>
          

      
        <li class="divider"></li>
        <li><label>分布式</label></li>

          
            <li><a title="概览" href="15630938148608.html">概览</a></li>
          
            <li><a title="分布式锁" href="15625959085058.html">分布式锁</a></li>
          
            <li><a title="分布式事务" href="15625700887049.html">分布式事务</a></li>
          
            <li><a title="ZooKeeper - 实现原理" href="15574104902395.html">ZooKeeper - 实现原理</a></li>
          
            <li><a title="ZK 分布式锁" href="15573683537890.html">ZK 分布式锁</a></li>
          
            <li><a title="ZooKeeper - 基本使用" href="15572415140464.html">ZooKeeper - 基本使用</a></li>
          
            <li><a title="Dubbo" href="15572232166193.html">Dubbo</a></li>
          
            <li><a title="分布式 - 一致性协议" href="15564260705049.html">分布式 - 一致性协议</a></li>
          
            <li><a title="ZooKeeper - ZAB 一致性协议" href="15561221442316.html">ZooKeeper - ZAB 一致性协议</a></li>
          
            <li><a title="分布式 - 理论" href="15559475613873.html">分布式 - 理论</a></li>
          

      
        <li class="divider"></li>
        <li><label>LeetCode</label></li>

          
            <li><a title="栈" href="15641207902154.html">栈</a></li>
          
            <li><a title="链表" href="15640409436152.html">链表</a></li>
          
            <li><a title="位运算" href="15640226818030.html">位运算</a></li>
          
            <li><a title="树相关" href="15638876391543.html">树相关</a></li>
          
            <li><a title="并查集(union-find)" href="15637156793274.html">并查集(union-find)</a></li>
          
            <li><a title="图相关" href="15637123231485.html">图相关</a></li>
          
            <li><a title="动态规划 - 2" href="15637092754569.html">动态规划 - 2</a></li>
          
            <li><a title="其他" href="15632741408063.html">其他</a></li>
          
            <li><a title="动态规划 - 2" href="15621444826793.html">动态规划 - 2</a></li>
          
            <li><a title="字符串" href="15621426919335.html">字符串</a></li>
          
            <li><a title="贪心策略" href="15621379435201.html">贪心策略</a></li>
          
            <li><a title="动态规划 - 1" href="15618801162146.html">动态规划 - 1</a></li>
          
            <li><a title="回溯" href="15617108626739.html">回溯</a></li>
          
            <li><a title="组合博弈" href="15617105581442.html">组合博弈</a></li>
          
            <li><a title="temp" href="15600064978396.html">temp</a></li>
          
            <li><a title="筛选法" href="15600041568309.html">筛选法</a></li>
          
            <li><a title="Sell Stock" href="15592212071515.html">Sell Stock</a></li>
          
            <li><a title="dfs" href="15590119399452.html">dfs</a></li>
          
            <li><a title="Index" href="15578365171892.html">Index</a></li>
          
            <li><a title="排序" href="15578363359025.html">排序</a></li>
          

      
        <li class="divider"></li>
        <li><label>算法</label></li>

          
            <li><a title="海量数据" href="15635229096880.html">海量数据</a></li>
          
            <li><a title="缓存" href="15616272119801.html">缓存</a></li>
          
            <li><a title="位操作" href="15421595266112.html">位操作</a></li>
          
            <li><a title="数据结构-搜索树" href="15382213735628.html">数据结构-搜索树</a></li>
          
            <li><a title="数据结构-查找" href="15381206652033.html">数据结构-查找</a></li>
          
            <li><a title="数据结构-栈与队列" href="15377961916563.html">数据结构-栈与队列</a></li>
          
            <li><a title="数据结构-树" href="15376956161325.html">数据结构-树</a></li>
          
            <li><a title="数据结构-图" href="15366535602244.html">数据结构-图</a></li>
          
            <li><a title="数据结构-排序" href="15366378611089.html">数据结构-排序</a></li>
          
            <li><a title="数据结构-线性表" href="15365715348624.html">数据结构-线性表</a></li>
          
            <li><a title="数据结构-绪论" href="15364817197942.html">数据结构-绪论</a></li>
          
            <li><a title="算法学习路径" href="15289789971496.html">算法学习路径</a></li>
          

      
        <li class="divider"></li>
        <li><label>工具</label></li>

          
            <li><a title="MyBatis" href="15590240129274.html">MyBatis</a></li>
          
            <li><a title="Guava" href="15573643454153.html">Guava</a></li>
          
            <li><a title="Lombok" href="15571355421205.html">Lombok</a></li>
          
            <li><a title="IntelliJ-IDEA" href="15568897283887.html">IntelliJ-IDEA</a></li>
          
            <li><a title="Git" href="15568705670148.html">Git</a></li>
          
            <li><a title="Maven" href="15547227910617.html">Maven</a></li>
          

      
        <li class="divider"></li>
        <li><label>网络</label></li>

          
            <li><a title="Netty" href="15633460791334.html">Netty</a></li>
          
            <li><a title="Http 授权" href="15629155221529.html">Http 授权</a></li>
          
            <li><a title="Https" href="15627233138405.html">Https</a></li>
          
            <li><a title="Http" href="15627233041942.html">Http</a></li>
          
            <li><a title="TCP" href="15627232889065.html">TCP</a></li>
          
            <li><a title="重要知识点" href="15561544288813.html">重要知识点</a></li>
          

      
        <li class="divider"></li>
        <li><label>Linux</label></li>

          
            <li><a title="Linux - I/O 模型" href="15560816178760.html">Linux - I/O 模型</a></li>
          
            <li><a title="Linux" href="15556621779917.html">Linux</a></li>
          

      
        <li class="divider"></li>
        <li><label>测试相关</label></li>

          
            <li><a title="Mockito" href="15590126556449.html">Mockito</a></li>
          
            <li><a title="测试相关" href="15587730878715.html">测试相关</a></li>
          
            <li><a title="JUnit" href="15579238927247.html">JUnit</a></li>
          
            <li><a title="测试" href="15579095305456.html">测试</a></li>
          

      
        <li class="divider"></li>
        <li><label>Web</label></li>

          
            <li><a title="Http 缓存控制" href="15616231135862.html">Http 缓存控制</a></li>
          
            <li><a title="HTTP API 认证" href="15616218028083.html">HTTP API 认证</a></li>
          

      
        <li class="divider"></li>
        <li><label>其他</label></li>

          
            <li><a title="计算机中的时间处理" href="15414917404912.html">计算机中的时间处理</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>Java</span></li>
                        
                          <li><a title="Java - 编码" href="15613569036612.html">Java - 编码</a></li>
                        
                          <li><a title="Java - Log" href="15594642382768.html">Java - Log</a></li>
                        
                          <li><a title="Java - 异常处理" href="15594627836663.html">Java - 异常处理</a></li>
                        
                          <li><a title="Java - Steam" href="15584212270447.html">Java - Steam</a></li>
                        
                          <li><a title="Java - 反射" href="15580921637682.html">Java - 反射</a></li>
                        
                          <li><a title="Java - Enum" href="15580808809919.html">Java - Enum</a></li>
                        
                          <li><a title="Javadoc" href="15573232964198.html">Javadoc</a></li>
                        
                          <li><a title="编程规范" href="15573214224993.html">编程规范</a></li>
                        
                          <li><a title="Java8" href="15571102853200.html">Java8</a></li>
                        
                          <li><a title="一些特性" href="15568697463497.html">一些特性</a></li>
                        
                          <li><a title="Java 补充" href="15557361529750.html">Java 补充</a></li>
                        
                          <li><a title="Java 基础" href="15554689517828.html">Java 基础</a></li>
                        
                          <li><a title="Java - IO" href="15551380554375.html">Java - IO</a></li>
                        
                          <li><a title="Java 经典设计模式" href="15548114065751.html">Java 经典设计模式</a></li>
                        
                          <li><a title="常用设计模式" href="15547272355117.html">常用设计模式</a></li>
                        
                          <li><a title="Java - 流(Stream)" href="15535872722415.html">Java - 流(Stream)</a></li>
                        

                    
                      <li class="side-title"><span>Java 集合</span></li>
                        
                          <li><a title="Java 集合 - List" href="15619627957699.html">Java 集合 - List</a></li>
                        
                          <li><a title="Java - 集合框架" href="15557398305311.html">Java - 集合框架</a></li>
                        

                    
                      <li class="side-title"><span>并发</span></li>
                        
                          <li><a title="Java 并发 - 同步器框架 AQS" href="15628279381258.html">Java 并发 - 同步器框架 AQS</a></li>
                        
                          <li><a title="Java 并发 - volatile 与 Java 内存模型(JMM)" href="15628250952791.html">Java 并发 - volatile 与 Java 内存模型(JMM)</a></li>
                        
                          <li><a title="Java 并发 - 生产者消费者模型" href="15551273585518.html">Java 并发 - 生产者消费者模型</a></li>
                        
                          <li><a title="Java 并发 - atomic" href="15551259864059.html">Java 并发 - atomic</a></li>
                        
                          <li><a title="Java 并发 - 线程池" href="15550409896106.html">Java 并发 - 线程池</a></li>
                        
                          <li><a title="Java 并发 - 常见并发容器" href="15549779705652.html">Java 并发 - 常见并发容器</a></li>
                        
                          <li><a title="Java 并发 - final 重排" href="15549631305867.html">Java 并发 - final 重排</a></li>
                        
                          <li><a title="Java 并发 - synchronized" href="15549492034730.html">Java 并发 - synchronized</a></li>
                        
                          <li><a title="Java 并发 - 线程" href="15549491562348.html">Java 并发 - 线程</a></li>
                        
                          <li><a title="Java 并发 - 常用同步器" href="15549094953523.html">Java 并发 - 常用同步器</a></li>
                        
                          <li><a title="Java 并发 - 概览" href="15536711259128.html">Java 并发 - 概览</a></li>
                        

                    
                      <li class="side-title"><span>JVM</span></li>
                        
                          <li><a title="Java JVM - 分析工具" href="15592858144445.html">Java JVM - 分析工具</a></li>
                        
                          <li><a title="Java JVM - 类加载" href="15554954352575.html">Java JVM - 类加载</a></li>
                        
                          <li><a title="Java JVM - GC" href="15551422971585.html">Java JVM - GC</a></li>
                        
                          <li><a title="Java JVM - 内存布局" href="15551417067858.html">Java JVM - 内存布局</a></li>
                        

                    
                      <li class="side-title"><span>Spring</span></li>
                        
                          <li><a title="Mybatis" href="15627234169476.html">Mybatis</a></li>
                        
                          <li><a title="Spring -  自定义标签" href="15580023414897.html">Spring -  自定义标签</a></li>
                        
                          <li><a title="Java - Servlet" href="15555575014317.html">Java - Servlet</a></li>
                        
                          <li><a title="Spring - 数据访问" href="15553337118605.html">Spring - 数据访问</a></li>
                        
                          <li><a title="spring 异步线程池" href="15546347724247.html">spring 异步线程池</a></li>
                        
                          <li><a title="Spring MVC" href="15546192348918.html">Spring MVC</a></li>
                        
                          <li><a title="Spring 事务" href="15544558066181.html">Spring 事务</a></li>
                        
                          <li><a title="Spring AOP" href="15543917219955.html">Spring AOP</a></li>
                        
                          <li><a title="Spring IoC" href="15543630452997.html">Spring IoC</a></li>
                        

                    
                      <li class="side-title"><span>源码</span></li>
                        
                          <li><a title="源码" href="15627233586740.html">源码</a></li>
                        

                    
                      <li class="side-title"><span>Redis</span></li>
                        
                          <li><a title="Redis 实现分布式锁" href="15565438727155.html">Redis 实现分布式锁</a></li>
                        
                          <li><a title="Redis 深入 - 双写一致性" href="15560904222673.html">Redis 深入 - 双写一致性</a></li>
                        
                          <li><a title="Redis 深入 - 高可用性" href="15560904056716.html">Redis 深入 - 高可用性</a></li>
                        
                          <li><a title="Redis 深入 - 数据结构" href="15560812001633.html">Redis 深入 - 数据结构</a></li>
                        
                          <li><a title="Redis 深入 - 常见问题" href="15556760212710.html">Redis 深入 - 常见问题</a></li>
                        
                          <li><a title="Redis 基本使用" href="15542783465338.html">Redis 基本使用</a></li>
                        

                    
                      <li class="side-title"><span>Mysql</span></li>
                        
                          <li><a title="Mysql - 键、索引、约束" href="15633466729778.html">Mysql - 键、索引、约束</a></li>
                        
                          <li><a title="Mysql - 性能优化" href="15633423972144.html">Mysql - 性能优化</a></li>
                        
                          <li><a title="索引中的树 - B,B+,B*" href="15633420860231.html">索引中的树 - B,B+,B*</a></li>
                        
                          <li><a title="性能优化" href="15607574336137.html">性能优化</a></li>
                        
                          <li><a title="Mysql - EXPLAIN" href="15607559623364.html">Mysql - EXPLAIN</a></li>
                        
                          <li><a title="Mysql 深入" href="15555007777074.html">Mysql 深入</a></li>
                        
                          <li><a title="Mysql 基本使用" href="15554985061309.html">Mysql 基本使用</a></li>
                        

                    
                      <li class="side-title"><span>消息队列</span></li>
                        
                          <li><a title="JMS" href="15584265544434.html">JMS</a></li>
                        
                          <li><a title="RPC - RMI" href="15572232721703.html">RPC - RMI</a></li>
                        
                          <li><a title="消息队列" href="15560753193297.html">消息队列</a></li>
                        

                    
                      <li class="side-title"><span>分布式</span></li>
                        
                          <li><a title="概览" href="15630938148608.html">概览</a></li>
                        
                          <li><a title="分布式锁" href="15625959085058.html">分布式锁</a></li>
                        
                          <li><a title="分布式事务" href="15625700887049.html">分布式事务</a></li>
                        
                          <li><a title="ZooKeeper - 实现原理" href="15574104902395.html">ZooKeeper - 实现原理</a></li>
                        
                          <li><a title="ZK 分布式锁" href="15573683537890.html">ZK 分布式锁</a></li>
                        
                          <li><a title="ZooKeeper - 基本使用" href="15572415140464.html">ZooKeeper - 基本使用</a></li>
                        
                          <li><a title="Dubbo" href="15572232166193.html">Dubbo</a></li>
                        
                          <li><a title="分布式 - 一致性协议" href="15564260705049.html">分布式 - 一致性协议</a></li>
                        
                          <li><a title="ZooKeeper - ZAB 一致性协议" href="15561221442316.html">ZooKeeper - ZAB 一致性协议</a></li>
                        
                          <li><a title="分布式 - 理论" href="15559475613873.html">分布式 - 理论</a></li>
                        

                    
                      <li class="side-title"><span>LeetCode</span></li>
                        
                          <li><a title="栈" href="15641207902154.html">栈</a></li>
                        
                          <li><a title="链表" href="15640409436152.html">链表</a></li>
                        
                          <li><a title="位运算" href="15640226818030.html">位运算</a></li>
                        
                          <li><a title="树相关" href="15638876391543.html">树相关</a></li>
                        
                          <li><a title="并查集(union-find)" href="15637156793274.html">并查集(union-find)</a></li>
                        
                          <li><a title="图相关" href="15637123231485.html">图相关</a></li>
                        
                          <li><a title="动态规划 - 2" href="15637092754569.html">动态规划 - 2</a></li>
                        
                          <li><a title="其他" href="15632741408063.html">其他</a></li>
                        
                          <li><a title="动态规划 - 2" href="15621444826793.html">动态规划 - 2</a></li>
                        
                          <li><a title="字符串" href="15621426919335.html">字符串</a></li>
                        
                          <li><a title="贪心策略" href="15621379435201.html">贪心策略</a></li>
                        
                          <li><a title="动态规划 - 1" href="15618801162146.html">动态规划 - 1</a></li>
                        
                          <li><a title="回溯" href="15617108626739.html">回溯</a></li>
                        
                          <li><a title="组合博弈" href="15617105581442.html">组合博弈</a></li>
                        
                          <li><a title="temp" href="15600064978396.html">temp</a></li>
                        
                          <li><a title="筛选法" href="15600041568309.html">筛选法</a></li>
                        
                          <li><a title="Sell Stock" href="15592212071515.html">Sell Stock</a></li>
                        
                          <li><a title="dfs" href="15590119399452.html">dfs</a></li>
                        
                          <li><a title="Index" href="15578365171892.html">Index</a></li>
                        
                          <li><a title="排序" href="15578363359025.html">排序</a></li>
                        

                    
                      <li class="side-title"><span>算法</span></li>
                        
                          <li><a title="海量数据" href="15635229096880.html">海量数据</a></li>
                        
                          <li><a title="缓存" href="15616272119801.html">缓存</a></li>
                        
                          <li><a title="位操作" href="15421595266112.html">位操作</a></li>
                        
                          <li><a title="数据结构-搜索树" href="15382213735628.html">数据结构-搜索树</a></li>
                        
                          <li><a title="数据结构-查找" href="15381206652033.html">数据结构-查找</a></li>
                        
                          <li><a title="数据结构-栈与队列" href="15377961916563.html">数据结构-栈与队列</a></li>
                        
                          <li><a title="数据结构-树" href="15376956161325.html">数据结构-树</a></li>
                        
                          <li><a title="数据结构-图" href="15366535602244.html">数据结构-图</a></li>
                        
                          <li><a title="数据结构-排序" href="15366378611089.html">数据结构-排序</a></li>
                        
                          <li><a title="数据结构-线性表" href="15365715348624.html">数据结构-线性表</a></li>
                        
                          <li><a title="数据结构-绪论" href="15364817197942.html">数据结构-绪论</a></li>
                        
                          <li><a title="算法学习路径" href="15289789971496.html">算法学习路径</a></li>
                        

                    
                      <li class="side-title"><span>工具</span></li>
                        
                          <li><a title="MyBatis" href="15590240129274.html">MyBatis</a></li>
                        
                          <li><a title="Guava" href="15573643454153.html">Guava</a></li>
                        
                          <li><a title="Lombok" href="15571355421205.html">Lombok</a></li>
                        
                          <li><a title="IntelliJ-IDEA" href="15568897283887.html">IntelliJ-IDEA</a></li>
                        
                          <li><a title="Git" href="15568705670148.html">Git</a></li>
                        
                          <li><a title="Maven" href="15547227910617.html">Maven</a></li>
                        

                    
                      <li class="side-title"><span>网络</span></li>
                        
                          <li><a title="Netty" href="15633460791334.html">Netty</a></li>
                        
                          <li><a title="Http 授权" href="15629155221529.html">Http 授权</a></li>
                        
                          <li><a title="Https" href="15627233138405.html">Https</a></li>
                        
                          <li><a title="Http" href="15627233041942.html">Http</a></li>
                        
                          <li><a title="TCP" href="15627232889065.html">TCP</a></li>
                        
                          <li><a title="重要知识点" href="15561544288813.html">重要知识点</a></li>
                        

                    
                      <li class="side-title"><span>Linux</span></li>
                        
                          <li><a title="Linux - I/O 模型" href="15560816178760.html">Linux - I/O 模型</a></li>
                        
                          <li><a title="Linux" href="15556621779917.html">Linux</a></li>
                        

                    
                      <li class="side-title"><span>测试相关</span></li>
                        
                          <li><a title="Mockito" href="15590126556449.html">Mockito</a></li>
                        
                          <li><a title="测试相关" href="15587730878715.html">测试相关</a></li>
                        
                          <li><a title="JUnit" href="15579238927247.html">JUnit</a></li>
                        
                          <li><a title="测试" href="15579095305456.html">测试</a></li>
                        

                    
                      <li class="side-title"><span>Web</span></li>
                        
                          <li><a title="Http 缓存控制" href="15616231135862.html">Http 缓存控制</a></li>
                        
                          <li><a title="HTTP API 认证" href="15616218028083.html">HTTP API 认证</a></li>
                        

                    
                      <li class="side-title"><span>其他</span></li>
                        
                          <li><a title="计算机中的时间处理" href="15414917404912.html">计算机中的时间处理</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>ZooKeeper - ZAB 一致性协议</h1>

<ul>
<li>
<a href="#toc_0">概念</a>
<ul>
<li>
<a href="#toc_1">角色</a>
</li>
<li>
<a href="#toc_2">特性</a>
</li>
<li>
<a href="#toc_3">目标</a>
</li>
<li>
<a href="#toc_4">其他</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">ZAB 协议</a>
<ul>
<li>
<a href="#toc_6">事务编号</a>
</li>
</ul>
</li>
<li>
<a href="#toc_7">协议模式</a>
<ul>
<li>
<a href="#toc_8">消息广播</a>
</li>
<li>
<a href="#toc_9">崩溃恢复</a>
</li>
</ul>
</li>
<li>
<a href="#toc_10">协议阶段</a>
<ul>
<li>
<a href="#toc_11">四阶段</a>
</li>
<li>
<a href="#toc_12">具体实现</a>
</li>
</ul>
</li>
<li>
<a href="#toc_13">Leader 选举</a>
<ul>
<li>
<a href="#toc_14">节点状态</a>
</li>
<li>
<a href="#toc_15">选票结构</a>
</li>
<li>
<a href="#toc_16">竞选流程</a>
</li>
<li>
<a href="#toc_17">选举实例</a>
</li>
</ul>
</li>
<li>
<a href="#toc_18">与 Paxos 的区别</a>
</li>
<li>
<a href="#toc_19">参考</a>
</li>
</ul>


<h2 id="toc_0">概念</h2>

<p>ZooKeeper 是一个<strong>分布式一致性的具体实现方案</strong>。<br/>
可以实现数据发布/订阅，负载均衡，命名服务，分布式协调/通知，集群管理，Master 选举，分布式锁，分布式队列，<strong>服务注册中心</strong>。</p>

<h3 id="toc_1">角色</h3>

<ol>
<li><strong>Leader</strong>，只有一个，它会发起并维护与各 Follwer 及 Observer 间的心跳。
<ul>
<li>向客户端提供读写，写操作要半数节点成功（不包括Observer），读操作会广播给其他节点。</li>
</ul></li>
<li><strong>Follower</strong>，多个，它会响应 Leader 的心跳。
<ul>
<li>提供读请求，向 Leader 转发写请求。</li>
<li>在 Leader 不可用时参与 Leader 选举。</li>
<li>响应过半写入成功策略。</li>
</ul></li>
<li><strong>Observer</strong>，多个，同样响应 Leader 的心跳。</li>
<li>* 提供读请求，向 Leader 转发写请求。
<ul>
<li><strong>不参与选举，也不参与过半写成功策略</strong>。</li>
<li>加入 Observer 是保证高可用，<strong>且加快了 Leader 选举的速度</strong>。</li>
</ul></li>
</ol>

<h3 id="toc_2">特性</h3>

<p>保证了如下的分布式一致性特性：</p>

<ol>
<li>顺序一致性，同个客户端事务请求会严格按顺序来执行。</li>
<li>原子性，事务具有原子性</li>
<li>单一视图，客户端无论连接哪个 ZooKeeper 服务器，看到的数据模型都是一致的。</li>
<li>可靠性，事务的作用是持久的。</li>
<li>实时性，事务作用后，客户端可以<strong>最终</strong>看到最新的数据状态。</li>
</ol>

<h3 id="toc_3">目标</h3>

<p>设计目标：</p>

<ol>
<li>简单的数据模型：使用树状的命名空间 ZNode</li>
<li>可以构建集群：</li>
<li>顺序访问：利用一个全局唯一的递增序号</li>
<li>高性能：数据全部存储在内存中</li>
</ol>

<h3 id="toc_4">其他</h3>

<ol>
<li>会话
<ul>
<li>集群通过 Session 向客户端标识一段会话</li>
</ul></li>
<li>数据节点(Znode)
<ul>
<li>集群内部维护了一棵树作为数据模型</li>
</ul></li>
<li>版本
<ul>
<li>Znode 内部会维护一个版本信息</li>
</ul></li>
<li>事件监视器(Watcher)
<ul>
<li>允许用户在节点上注册监听器，可以通知事件</li>
</ul></li>
<li>ACL(Access Control Lists) 权限控制策略
<ul>
<li>create，创建子节点</li>
<li>read，获得节点及其子节点列表</li>
<li>write，更新节点数据</li>
<li>delete，删除子节点</li>
<li>admin，设置节点</li>
</ul></li>
</ol>

<h2 id="toc_5">ZAB 协议</h2>

<p>ZAB(ZooKeeper Atomic broadcast protocol) 是 ZK 专门基于 Paxos 实现的一种<strong>支持崩溃恢复的原子广播协议</strong>。<br/>
从模式上可以分为两种模式</p>

<ol>
<li>消息广播</li>
<li>崩溃恢复</li>
</ol>

<p>从启动阶段上可以分为四个阶段：</p>

<ol>
<li>选举阶段</li>
<li>发现阶段</li>
<li>同步阶段</li>
<li>广播阶段</li>
</ol>

<p>下面会详细说明。</p>

<h3 id="toc_6">事务编号</h3>

<p>注意这里的<strong>事务概念与数据中 ACID 的事务概念有所不同</strong>。<br/>
ZooKeeper 中的事务指的是<strong>能够改变 ZooKeeper 服务器状态的操作</strong>。一般包括数据节点创建与删除、数据节点内容更新和客户端会话创建与失效等操作。对于每一个事务请求，ZooKeeper 都会为其分配一个全局唯一的事务ID,用 ZXID 来表示。<br/>
事务编号(Zxid)是 ZAB 协议为了保证事务顺序性和崩溃恢复以及 Leader 选举的重要概念。<br/>
其本质是是一个 64bit 的数字用于标识客户端的事务：</p>

<ol>
<li>zkid，低32位，对于客户端每一个事务请求单调递增+1，用于保证事务顺序性的。</li>
<li>epochid，高32位，表示 Leader 周期 epoch 的编号
<ul>
<li>每个当选产生一个新 的 Leader 服务器，就会从这个 Leader 服务器上取出其本地日志中最大事务的 ZXID，并从中读取 epoch 值，然后加 1，以此作为新的 epoch</li>
</ul></li>
</ol>

<h2 id="toc_7">协议模式</h2>

<h3 id="toc_8">消息广播</h3>

<p>当 Leader 节点被选举出，且大多数 Server (即包括了 Follower 和 Observer)完成了和 Leader 的状态同步以后，恢复模式就结束了。状态同步保证了 Leader 和 Server 具有相同的系统状态。<br/>
<strong>Prepare 阶段</strong></p>

<ol>
<li>Leader，主要负责将客户端的事务请求封装成 Proposal 来进行广播。
<ol>
<li>为事务分配全局唯一的 ZXID，并按顺序进行广播。</li>
<li>消息广播过程中，Leader 会为每一个 Follower 维护一个队列依次放入 Proposal。</li>
</ol></li>
<li>Follower，主要负责提交事务并向 Leader 响应。
<ol>
<li>收到 Proposal 之后将<strong>事务日志写入磁盘</strong>。</li>
<li>向 Leader 响应 ACK。</li>
</ol></li>
</ol>

<p><strong>Commit 阶段</strong></p>

<ol>
<li>Leader 受到过半的 ACK 响应后，广播 Commit 提交事务。并完成自身的事务提交。</li>
<li>Follower 在接收到 Commit 消息后，完成对事务的提交</li>
</ol>

<h3 id="toc_9">崩溃恢复</h3>

<p>当 Leader 服务器出现崩溃，或者由于网络原因失去了与过半 Follower 的联系，就会进入崩溃恢复模式。<br/>
具体来说就是，Leader 会与 Follower 进行心跳维护，<strong>如果 Leader 在超时时间内收到的正常心跳少于半数，就会将自己的状态变为 Looking</strong>。其他 Follower 放弃该 Leader 并进行 Leader 选举。</p>

<p>崩溃恢复中可能出现数据不一致的隐患：</p>

<ol>
<li>确保那些已经在 Leader 服务器上 Commit 的事务最终被所有服务器都 Commit
<ul>
<li>比如一个 Proposel 在 Leader 服务器上被提交了，并且得到过半 Follower 服务器的 Ack 反馈，但它在发送 Commit 之前挂了。</li>
</ul></li>
<li>确保丢弃那些只在 Leader 服务器上被 Commit 的事务
<ul>
<li>假设 Leader 服务器 Commit 一个 Proposal 之后就崩溃了，从而导致集群中其他服务器都没有收到这个 Proposal 的 Commit，于是当该服务器恢复过来再次加入集群的时候，ZAB协议需要确认丢弃这个 Proposal。</li>
</ul></li>
</ol>

<p>做到以上两点只需要让选举算法能够<strong>保证新的 Leader 拥有所有 Follower 中ZXID最大的 Proposal</strong>。这样就做到了：</p>

<ol>
<li>保证新的 Leader 一定具有所有已经提交的提案。</li>
<li>省去 Leader 检查 Proposal 的提交和丢弃工作。</li>
</ol>

<p><strong>数据同步</strong><br/>
选举完成后还有有一个数据同步的阶段，Follower 将自己的状态同步至 Leader 的状态，这个通过 TXID 来实现。</p>

<h2 id="toc_10">协议阶段</h2>

<h3 id="toc_11">四阶段</h3>

<ol>
<li>选举阶段(Leader election)，<strong>选举准 Leader</strong>：
<ul>
<li>节点在一开始都处于选举阶段，只要有一个节点得到超半数 节点的票数，它就可以当选准 Leader。</li>
<li>只有到达 广播阶段准 Leader 才会成 为真正的 Leader。</li>
</ul></li>
<li>发现阶段(Discovery)，<strong>生成和接受 epoch</strong>：
<ul>
<li>Followers 跟准 Leader 进行通信，同步 Followers 最近接收的事务提议。</li>
<li>准 Leader 生成新的 epoch，让 Followers 接受，更新它们的 accepted Epoch。</li>
</ul></li>
<li>同步阶段(Synchronization)，<strong>同步 Follower 副本</strong>：
<ul>
<li>Leader 前一阶段获得的最新提议历史，同步集群中所有的副本。<strong>只有当大多数节点都同步完成，准 Leader 才会成为真正的 Leader</strong>。</li>
<li>follower 只会接收 zxid 比自己的 lastZxid 大的提议。</li>
</ul></li>
<li>广播阶段(Broadcast)，<strong>Leader 消息广播</strong>：
<ul>
<li>Zookeeper 集群正式对外提供事务服务， 并且 Leader 可以进行消息广播。</li>
<li>如果有新的节点加入，还需要对新节点进行同步。</li>
</ul></li>
</ol>

<h3 id="toc_12">具体实现</h3>

<p>协议的 Java 版本实现跟上面的定义有些不同，选举阶段使用的是 Fast Leader Election（FLE）， 它包含了选举的发现职责。因为 FLE 会选举拥有最新提议历史的节点作为 leader，这样就省去了 发现最新提议的步骤。实际的实现<strong>将发现阶段和同步合并</strong>为 Recovery Phase（恢复阶段）。<br/>
所以，ZAB 的实现只有三个阶段：Fast Leader Election；Recovery Phase；Broadcast Phase。</p>

<h2 id="toc_13">Leader 选举</h2>

<p>这里以 基于TCP的 FastLeaderElection 为例详细说明一下选举流程。</p>

<h3 id="toc_14">节点状态</h3>

<p>节点在选举的不同阶段有不同的状态：</p>

<ul>
<li><code>LOOKING</code> 选举状态。该状态下的服务器认为当前集群中没有 Leader</li>
<li><code>FOLLOWING</code> 跟随者状态。表明当前服务器角色是 Follower，并且它知道 Leader 是谁。</li>
<li><code>LEADING</code> 领导者状态。表明当前服务器角色是 Leader，它会维护与 Follower 间的心跳。</li>
<li><code>OBSERVING</code> 观察者状态。表明当前服务器角色是 Observer，与 Folower 唯一的不同在于不参与选举，也不参与集群写操作时的投票。</li>
</ul>

<h3 id="toc_15">选票结构</h3>

<p>在选票竞争的过程中有两个重要的比较字段：</p>

<ol>
<li>myid，表示服务器的集群唯一整数 ID</li>
<li>zxid，前面已经详细说明过</li>
</ol>

<p>用于 Follower 进行选票竞争的选票结构：</p>

<ul>
<li><code>logicClock</code> 每个服务器会维护一个自增的整数，名为logicClock，它表示这是该服务器发起的第多少轮投票</li>
<li><code>state</code> 当前服务器的状态</li>
<li><code>self_id</code> 当前服务器的myid</li>
<li><code>self_zxid</code> 当前服务器上所保存的数据的最大zxid</li>
<li><code>vote_id</code> 被推举的服务器的myid</li>
<li><code>vote_zxid</code> 被推举的服务器上所保存的数据的最大zxid</li>
</ul>

<h3 id="toc_16">竞选流程</h3>

<ol>
<li><strong>自增选举轮次</strong>
<ul>
<li>每个服务器在开始新一轮投票时，会先对自己维护的 logicClock 进行自增操作。</li>
</ul></li>
<li><strong>初始化选票</strong>
<ul>
<li>广播自己的选票前，将自己的投票箱清空。</li>
</ul></li>
<li><strong>发送初始化选票</strong>
<ul>
<li>每个服务器最开始通过广播把票投给自己。</li>
</ul></li>
<li><strong>接收外部投票</strong>
<ul>
<li>服务器会尝试从其它服务器获取投票</li>
</ul></li>
<li><strong>判断选举轮次</strong>
<ul>
<li>判断自己和外部选票 logicClock 大小进行不同的处理，
<ol>
<li>自己的大，忽略。</li>
<li>自己的小，说明选举轮次落后了。清空投票箱，并更新 logicClock，重新投票并广播。</li>
<li>相同，进入选票竞争阶段。</li>
</ol></li>
</ul></li>
<li><strong>选票竞争</strong>
<ul>
<li>基于(self_id, self_zxid)与(vote_id, vote_zxid)进行选票竞争
<ol>
<li>先对比 vote_zxid，如果外部的票大，则用外部的票覆盖自己的票并广播且更新选票箱。</li>
<li>如果 vote_zxid 一致，对比 vote_id，与上一步同理。</li>
</ol></li>
</ul></li>
<li><strong>统计选票</strong>
<ul>
<li>如果已经确定有过半服务器认可了自己的投票（可能是更新后的投票），则终止投票。否则继续接收其它服务器的投票。</li>
</ul></li>
<li><strong>更新服务器状态</strong>
<ul>
<li>投票终止后，服务器开始更新自身状态。若过半的票投给了自己，则将自己的服务器状态更新为 LEADING，否则将自己的状态更新为 FOLLOWING。</li>
</ul></li>
</ol>

<p><img src="media/15561221442316/15575664581590.jpg" alt="" style="width:596px;"/></p>

<p>当完成选举和数据同步后，ZAB 就重新回到了广播阶段。</p>

<h3 id="toc_17">选举实例</h3>

<p>目前有 5 台服务器，每台服务器均没有数据，它们的编号分别是 1,2,3,4,5 按编号依次启动，它们的选择举过程如下：</p>

<ol>
<li>服务器 1 启动，给自己投票，然后发投票信息，由于其它机器还没有启动所以它收不到反馈信息，服务器 1 的状态一直属于 Looking。</li>
<li>服务器 2 启动，给自己投票，同时与之前启动的服务器 1 交换结果，由于服务器 2 的编号大所以服务器 2 胜出，但此时投票数没有大于半数，所以两个服务器的状态依然是LOOKING。</li>
<li>服务器 3 启动，给自己投票，同时与之前启动的服务器 1,2 交换信息，由于服务器 3 的编号最大所以服务器 3 胜出，此时投票数正好大于半数，所以服务器 3 成为领导者，服务器 1,2 成为小弟。</li>
<li>服务器 4 启动，给自己投票，同时与之前启动的服务器 1,2,3 交换信息，尽管服务器 4 的编号大，但之前服务器 3 已经胜出，所以服务器 4 只能成为小弟。</li>
<li>服务器 5 启动，后面的逻辑同服务器 4 成为小弟。</li>
</ol>

<h2 id="toc_18">与 Paxos 的区别</h2>

<p>总体来说，ZAB 与 PAXOS 算法的区别在于，前者要维护一个高可用的分布式<strong>主备系统</strong>，后者是一个分布式一致性状态机。</p>

<h2 id="toc_19">参考</h2>

<ol>
<li><a href="">《从PAXOS到ZOOKEEPER分布式一致性原理与实践》</a></li>
<li><a href="https://dbaplus.cn/news-141-1875-1.html">实例详解ZooKeeper ZAB协议、分布式锁与领导选举</a></li>
<li><a href="https://juejin.im/post/5b924b0de51d450e9a2de615">看大牛如何分析Zookeeper ZAB 协议</a></li>
</ol>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15561544288813.html"  title="Previous Post: 重要知识点">&laquo; 重要知识点</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15560904222673.html" 
	        title="Next Post: Redis 深入 - 双写一致性">Redis 深入 - 双写一致性 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15561221442316.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
