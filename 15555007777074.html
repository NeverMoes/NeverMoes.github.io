<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  Mysql 深入 - NeverMoes 的笔记
  
  </title>
 <meta name="description" content="">
 <link href="atom.xml" rel="alternate" title="NeverMoes 的笔记" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />

    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
    <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
    <script>hljs.initHighlightingOnLoad();</script>
    
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>

<div id="header">
    <h1><a href="index.html">NeverMoes 的笔记</a></h1>
</div>

</nav>
        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; NeverMoes 的笔记</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
      <li><a href="index.html">Home</a></li>
      
        <li class="divider"></li>
        <li><label>Java</label></li>

          
            <li><a title="Java - 编码" href="15613569036612.html">Java - 编码</a></li>
          
            <li><a title="Java - Log" href="15594642382768.html">Java - Log</a></li>
          
            <li><a title="Java - 异常处理" href="15594627836663.html">Java - 异常处理</a></li>
          
            <li><a title="Java - Steam" href="15584212270447.html">Java - Steam</a></li>
          
            <li><a title="Java - 反射" href="15580921637682.html">Java - 反射</a></li>
          
            <li><a title="Java - Enum" href="15580808809919.html">Java - Enum</a></li>
          
            <li><a title="Javadoc" href="15573232964198.html">Javadoc</a></li>
          
            <li><a title="编程规范" href="15573214224993.html">编程规范</a></li>
          
            <li><a title="Java8" href="15571102853200.html">Java8</a></li>
          
            <li><a title="一些特性" href="15568697463497.html">一些特性</a></li>
          
            <li><a title="Java 补充" href="15557361529750.html">Java 补充</a></li>
          
            <li><a title="Java 基础" href="15554689517828.html">Java 基础</a></li>
          
            <li><a title="Java - IO" href="15551380554375.html">Java - IO</a></li>
          
            <li><a title="Java 经典设计模式" href="15548114065751.html">Java 经典设计模式</a></li>
          
            <li><a title="常用设计模式" href="15547272355117.html">常用设计模式</a></li>
          
            <li><a title="Java - 流(Stream)" href="15535872722415.html">Java - 流(Stream)</a></li>
          

      
        <li class="divider"></li>
        <li><label>Java 集合</label></li>

          
            <li><a title="Java 集合 - List" href="15619627957699.html">Java 集合 - List</a></li>
          
            <li><a title="Java - 集合框架" href="15557398305311.html">Java - 集合框架</a></li>
          

      
        <li class="divider"></li>
        <li><label>并发</label></li>

          
            <li><a title="Java 并发 - 同步器框架 AQS" href="15628279381258.html">Java 并发 - 同步器框架 AQS</a></li>
          
            <li><a title="Java 并发 - volatile 与 Java 内存模型(JMM)" href="15628250952791.html">Java 并发 - volatile 与 Java 内存模型(JMM)</a></li>
          
            <li><a title="Java 并发 - 生产者消费者模型" href="15551273585518.html">Java 并发 - 生产者消费者模型</a></li>
          
            <li><a title="Java 并发 - atomic" href="15551259864059.html">Java 并发 - atomic</a></li>
          
            <li><a title="Java 并发 - 线程池" href="15550409896106.html">Java 并发 - 线程池</a></li>
          
            <li><a title="Java 并发 - 常见并发容器" href="15549779705652.html">Java 并发 - 常见并发容器</a></li>
          
            <li><a title="Java 并发 - final 重排" href="15549631305867.html">Java 并发 - final 重排</a></li>
          
            <li><a title="Java 并发 - synchronized" href="15549492034730.html">Java 并发 - synchronized</a></li>
          
            <li><a title="Java 并发 - 线程" href="15549491562348.html">Java 并发 - 线程</a></li>
          
            <li><a title="Java 并发 - 常用同步器" href="15549094953523.html">Java 并发 - 常用同步器</a></li>
          
            <li><a title="Java 并发 - 概览" href="15536711259128.html">Java 并发 - 概览</a></li>
          

      
        <li class="divider"></li>
        <li><label>JVM</label></li>

          
            <li><a title="Java JVM - 分析工具" href="15592858144445.html">Java JVM - 分析工具</a></li>
          
            <li><a title="Java JVM - 类加载" href="15554954352575.html">Java JVM - 类加载</a></li>
          
            <li><a title="Java JVM - GC" href="15551422971585.html">Java JVM - GC</a></li>
          
            <li><a title="Java JVM - 内存布局" href="15551417067858.html">Java JVM - 内存布局</a></li>
          

      
        <li class="divider"></li>
        <li><label>Spring</label></li>

          
            <li><a title="Mybatis" href="15627234169476.html">Mybatis</a></li>
          
            <li><a title="Spring -  自定义标签" href="15580023414897.html">Spring -  自定义标签</a></li>
          
            <li><a title="Java - Servlet" href="15555575014317.html">Java - Servlet</a></li>
          
            <li><a title="Spring - 数据访问" href="15553337118605.html">Spring - 数据访问</a></li>
          
            <li><a title="spring 异步线程池" href="15546347724247.html">spring 异步线程池</a></li>
          
            <li><a title="Spring MVC" href="15546192348918.html">Spring MVC</a></li>
          
            <li><a title="Spring 事务" href="15544558066181.html">Spring 事务</a></li>
          
            <li><a title="Spring AOP" href="15543917219955.html">Spring AOP</a></li>
          
            <li><a title="Spring IoC" href="15543630452997.html">Spring IoC</a></li>
          

      
        <li class="divider"></li>
        <li><label>源码</label></li>

          
            <li><a title="源码" href="15627233586740.html">源码</a></li>
          

      
        <li class="divider"></li>
        <li><label>Redis</label></li>

          
            <li><a title="Redis 实现分布式锁" href="15565438727155.html">Redis 实现分布式锁</a></li>
          
            <li><a title="Redis 深入 - 双写一致性" href="15560904222673.html">Redis 深入 - 双写一致性</a></li>
          
            <li><a title="Redis 深入 - 高可用性" href="15560904056716.html">Redis 深入 - 高可用性</a></li>
          
            <li><a title="Redis 深入 - 数据结构" href="15560812001633.html">Redis 深入 - 数据结构</a></li>
          
            <li><a title="Redis 深入 - 常见问题" href="15556760212710.html">Redis 深入 - 常见问题</a></li>
          
            <li><a title="Redis 基本使用" href="15542783465338.html">Redis 基本使用</a></li>
          

      
        <li class="divider"></li>
        <li><label>Mysql</label></li>

          
            <li><a title="Mysql - 键、索引、约束" href="15633466729778.html">Mysql - 键、索引、约束</a></li>
          
            <li><a title="Mysql - 性能优化" href="15633423972144.html">Mysql - 性能优化</a></li>
          
            <li><a title="索引中的树 - B,B+,B*" href="15633420860231.html">索引中的树 - B,B+,B*</a></li>
          
            <li><a title="性能优化" href="15607574336137.html">性能优化</a></li>
          
            <li><a title="Mysql - EXPLAIN" href="15607559623364.html">Mysql - EXPLAIN</a></li>
          
            <li><a title="Mysql 深入" href="15555007777074.html">Mysql 深入</a></li>
          
            <li><a title="Mysql 基本使用" href="15554985061309.html">Mysql 基本使用</a></li>
          

      
        <li class="divider"></li>
        <li><label>消息队列</label></li>

          
            <li><a title="JMS" href="15584265544434.html">JMS</a></li>
          
            <li><a title="RPC - RMI" href="15572232721703.html">RPC - RMI</a></li>
          
            <li><a title="消息队列" href="15560753193297.html">消息队列</a></li>
          

      
        <li class="divider"></li>
        <li><label>分布式</label></li>

          
            <li><a title="概览" href="15630938148608.html">概览</a></li>
          
            <li><a title="分布式锁" href="15625959085058.html">分布式锁</a></li>
          
            <li><a title="分布式事务" href="15625700887049.html">分布式事务</a></li>
          
            <li><a title="ZooKeeper - 实现原理" href="15574104902395.html">ZooKeeper - 实现原理</a></li>
          
            <li><a title="ZK 分布式锁" href="15573683537890.html">ZK 分布式锁</a></li>
          
            <li><a title="ZooKeeper - 基本使用" href="15572415140464.html">ZooKeeper - 基本使用</a></li>
          
            <li><a title="Dubbo" href="15572232166193.html">Dubbo</a></li>
          
            <li><a title="分布式 - 一致性协议" href="15564260705049.html">分布式 - 一致性协议</a></li>
          
            <li><a title="ZooKeeper - ZAB 一致性协议" href="15561221442316.html">ZooKeeper - ZAB 一致性协议</a></li>
          
            <li><a title="分布式 - 理论" href="15559475613873.html">分布式 - 理论</a></li>
          

      
        <li class="divider"></li>
        <li><label>LeetCode</label></li>

          
            <li><a title="栈" href="15641207902154.html">栈</a></li>
          
            <li><a title="链表" href="15640409436152.html">链表</a></li>
          
            <li><a title="位运算" href="15640226818030.html">位运算</a></li>
          
            <li><a title="树相关" href="15638876391543.html">树相关</a></li>
          
            <li><a title="并查集(union-find)" href="15637156793274.html">并查集(union-find)</a></li>
          
            <li><a title="图相关" href="15637123231485.html">图相关</a></li>
          
            <li><a title="动态规划 - 2" href="15637092754569.html">动态规划 - 2</a></li>
          
            <li><a title="其他" href="15632741408063.html">其他</a></li>
          
            <li><a title="动态规划 - 2" href="15621444826793.html">动态规划 - 2</a></li>
          
            <li><a title="字符串" href="15621426919335.html">字符串</a></li>
          
            <li><a title="贪心策略" href="15621379435201.html">贪心策略</a></li>
          
            <li><a title="动态规划 - 1" href="15618801162146.html">动态规划 - 1</a></li>
          
            <li><a title="回溯" href="15617108626739.html">回溯</a></li>
          
            <li><a title="组合博弈" href="15617105581442.html">组合博弈</a></li>
          
            <li><a title="temp" href="15600064978396.html">temp</a></li>
          
            <li><a title="筛选法" href="15600041568309.html">筛选法</a></li>
          
            <li><a title="Sell Stock" href="15592212071515.html">Sell Stock</a></li>
          
            <li><a title="dfs" href="15590119399452.html">dfs</a></li>
          
            <li><a title="Index" href="15578365171892.html">Index</a></li>
          
            <li><a title="排序" href="15578363359025.html">排序</a></li>
          

      
        <li class="divider"></li>
        <li><label>算法</label></li>

          
            <li><a title="海量数据" href="15635229096880.html">海量数据</a></li>
          
            <li><a title="缓存" href="15616272119801.html">缓存</a></li>
          
            <li><a title="位操作" href="15421595266112.html">位操作</a></li>
          
            <li><a title="数据结构-搜索树" href="15382213735628.html">数据结构-搜索树</a></li>
          
            <li><a title="数据结构-查找" href="15381206652033.html">数据结构-查找</a></li>
          
            <li><a title="数据结构-栈与队列" href="15377961916563.html">数据结构-栈与队列</a></li>
          
            <li><a title="数据结构-树" href="15376956161325.html">数据结构-树</a></li>
          
            <li><a title="数据结构-图" href="15366535602244.html">数据结构-图</a></li>
          
            <li><a title="数据结构-排序" href="15366378611089.html">数据结构-排序</a></li>
          
            <li><a title="数据结构-线性表" href="15365715348624.html">数据结构-线性表</a></li>
          
            <li><a title="数据结构-绪论" href="15364817197942.html">数据结构-绪论</a></li>
          
            <li><a title="算法学习路径" href="15289789971496.html">算法学习路径</a></li>
          

      
        <li class="divider"></li>
        <li><label>工具</label></li>

          
            <li><a title="MyBatis" href="15590240129274.html">MyBatis</a></li>
          
            <li><a title="Guava" href="15573643454153.html">Guava</a></li>
          
            <li><a title="Lombok" href="15571355421205.html">Lombok</a></li>
          
            <li><a title="IntelliJ-IDEA" href="15568897283887.html">IntelliJ-IDEA</a></li>
          
            <li><a title="Git" href="15568705670148.html">Git</a></li>
          
            <li><a title="Maven" href="15547227910617.html">Maven</a></li>
          

      
        <li class="divider"></li>
        <li><label>网络</label></li>

          
            <li><a title="Netty" href="15633460791334.html">Netty</a></li>
          
            <li><a title="Http 授权" href="15629155221529.html">Http 授权</a></li>
          
            <li><a title="Https" href="15627233138405.html">Https</a></li>
          
            <li><a title="Http" href="15627233041942.html">Http</a></li>
          
            <li><a title="TCP" href="15627232889065.html">TCP</a></li>
          
            <li><a title="重要知识点" href="15561544288813.html">重要知识点</a></li>
          

      
        <li class="divider"></li>
        <li><label>Linux</label></li>

          
            <li><a title="Linux - I/O 模型" href="15560816178760.html">Linux - I/O 模型</a></li>
          
            <li><a title="Linux" href="15556621779917.html">Linux</a></li>
          

      
        <li class="divider"></li>
        <li><label>测试相关</label></li>

          
            <li><a title="Mockito" href="15590126556449.html">Mockito</a></li>
          
            <li><a title="测试相关" href="15587730878715.html">测试相关</a></li>
          
            <li><a title="JUnit" href="15579238927247.html">JUnit</a></li>
          
            <li><a title="测试" href="15579095305456.html">测试</a></li>
          

      
        <li class="divider"></li>
        <li><label>Web</label></li>

          
            <li><a title="Http 缓存控制" href="15616231135862.html">Http 缓存控制</a></li>
          
            <li><a title="HTTP API 认证" href="15616218028083.html">HTTP API 认证</a></li>
          

      
        <li class="divider"></li>
        <li><label>其他</label></li>

          
            <li><a title="计算机中的时间处理" href="15414917404912.html">计算机中的时间处理</a></li>
          

      
      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>

        <section id="main-content" role="main" class="scroll-container">

          <div class="row">
            <div class="large-3 medium-3 columns">
              <div class="hide-for-small">
                <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">

                    
                      <li class="side-title"><span>Java</span></li>
                        
                          <li><a title="Java - 编码" href="15613569036612.html">Java - 编码</a></li>
                        
                          <li><a title="Java - Log" href="15594642382768.html">Java - Log</a></li>
                        
                          <li><a title="Java - 异常处理" href="15594627836663.html">Java - 异常处理</a></li>
                        
                          <li><a title="Java - Steam" href="15584212270447.html">Java - Steam</a></li>
                        
                          <li><a title="Java - 反射" href="15580921637682.html">Java - 反射</a></li>
                        
                          <li><a title="Java - Enum" href="15580808809919.html">Java - Enum</a></li>
                        
                          <li><a title="Javadoc" href="15573232964198.html">Javadoc</a></li>
                        
                          <li><a title="编程规范" href="15573214224993.html">编程规范</a></li>
                        
                          <li><a title="Java8" href="15571102853200.html">Java8</a></li>
                        
                          <li><a title="一些特性" href="15568697463497.html">一些特性</a></li>
                        
                          <li><a title="Java 补充" href="15557361529750.html">Java 补充</a></li>
                        
                          <li><a title="Java 基础" href="15554689517828.html">Java 基础</a></li>
                        
                          <li><a title="Java - IO" href="15551380554375.html">Java - IO</a></li>
                        
                          <li><a title="Java 经典设计模式" href="15548114065751.html">Java 经典设计模式</a></li>
                        
                          <li><a title="常用设计模式" href="15547272355117.html">常用设计模式</a></li>
                        
                          <li><a title="Java - 流(Stream)" href="15535872722415.html">Java - 流(Stream)</a></li>
                        

                    
                      <li class="side-title"><span>Java 集合</span></li>
                        
                          <li><a title="Java 集合 - List" href="15619627957699.html">Java 集合 - List</a></li>
                        
                          <li><a title="Java - 集合框架" href="15557398305311.html">Java - 集合框架</a></li>
                        

                    
                      <li class="side-title"><span>并发</span></li>
                        
                          <li><a title="Java 并发 - 同步器框架 AQS" href="15628279381258.html">Java 并发 - 同步器框架 AQS</a></li>
                        
                          <li><a title="Java 并发 - volatile 与 Java 内存模型(JMM)" href="15628250952791.html">Java 并发 - volatile 与 Java 内存模型(JMM)</a></li>
                        
                          <li><a title="Java 并发 - 生产者消费者模型" href="15551273585518.html">Java 并发 - 生产者消费者模型</a></li>
                        
                          <li><a title="Java 并发 - atomic" href="15551259864059.html">Java 并发 - atomic</a></li>
                        
                          <li><a title="Java 并发 - 线程池" href="15550409896106.html">Java 并发 - 线程池</a></li>
                        
                          <li><a title="Java 并发 - 常见并发容器" href="15549779705652.html">Java 并发 - 常见并发容器</a></li>
                        
                          <li><a title="Java 并发 - final 重排" href="15549631305867.html">Java 并发 - final 重排</a></li>
                        
                          <li><a title="Java 并发 - synchronized" href="15549492034730.html">Java 并发 - synchronized</a></li>
                        
                          <li><a title="Java 并发 - 线程" href="15549491562348.html">Java 并发 - 线程</a></li>
                        
                          <li><a title="Java 并发 - 常用同步器" href="15549094953523.html">Java 并发 - 常用同步器</a></li>
                        
                          <li><a title="Java 并发 - 概览" href="15536711259128.html">Java 并发 - 概览</a></li>
                        

                    
                      <li class="side-title"><span>JVM</span></li>
                        
                          <li><a title="Java JVM - 分析工具" href="15592858144445.html">Java JVM - 分析工具</a></li>
                        
                          <li><a title="Java JVM - 类加载" href="15554954352575.html">Java JVM - 类加载</a></li>
                        
                          <li><a title="Java JVM - GC" href="15551422971585.html">Java JVM - GC</a></li>
                        
                          <li><a title="Java JVM - 内存布局" href="15551417067858.html">Java JVM - 内存布局</a></li>
                        

                    
                      <li class="side-title"><span>Spring</span></li>
                        
                          <li><a title="Mybatis" href="15627234169476.html">Mybatis</a></li>
                        
                          <li><a title="Spring -  自定义标签" href="15580023414897.html">Spring -  自定义标签</a></li>
                        
                          <li><a title="Java - Servlet" href="15555575014317.html">Java - Servlet</a></li>
                        
                          <li><a title="Spring - 数据访问" href="15553337118605.html">Spring - 数据访问</a></li>
                        
                          <li><a title="spring 异步线程池" href="15546347724247.html">spring 异步线程池</a></li>
                        
                          <li><a title="Spring MVC" href="15546192348918.html">Spring MVC</a></li>
                        
                          <li><a title="Spring 事务" href="15544558066181.html">Spring 事务</a></li>
                        
                          <li><a title="Spring AOP" href="15543917219955.html">Spring AOP</a></li>
                        
                          <li><a title="Spring IoC" href="15543630452997.html">Spring IoC</a></li>
                        

                    
                      <li class="side-title"><span>源码</span></li>
                        
                          <li><a title="源码" href="15627233586740.html">源码</a></li>
                        

                    
                      <li class="side-title"><span>Redis</span></li>
                        
                          <li><a title="Redis 实现分布式锁" href="15565438727155.html">Redis 实现分布式锁</a></li>
                        
                          <li><a title="Redis 深入 - 双写一致性" href="15560904222673.html">Redis 深入 - 双写一致性</a></li>
                        
                          <li><a title="Redis 深入 - 高可用性" href="15560904056716.html">Redis 深入 - 高可用性</a></li>
                        
                          <li><a title="Redis 深入 - 数据结构" href="15560812001633.html">Redis 深入 - 数据结构</a></li>
                        
                          <li><a title="Redis 深入 - 常见问题" href="15556760212710.html">Redis 深入 - 常见问题</a></li>
                        
                          <li><a title="Redis 基本使用" href="15542783465338.html">Redis 基本使用</a></li>
                        

                    
                      <li class="side-title"><span>Mysql</span></li>
                        
                          <li><a title="Mysql - 键、索引、约束" href="15633466729778.html">Mysql - 键、索引、约束</a></li>
                        
                          <li><a title="Mysql - 性能优化" href="15633423972144.html">Mysql - 性能优化</a></li>
                        
                          <li><a title="索引中的树 - B,B+,B*" href="15633420860231.html">索引中的树 - B,B+,B*</a></li>
                        
                          <li><a title="性能优化" href="15607574336137.html">性能优化</a></li>
                        
                          <li><a title="Mysql - EXPLAIN" href="15607559623364.html">Mysql - EXPLAIN</a></li>
                        
                          <li><a title="Mysql 深入" href="15555007777074.html">Mysql 深入</a></li>
                        
                          <li><a title="Mysql 基本使用" href="15554985061309.html">Mysql 基本使用</a></li>
                        

                    
                      <li class="side-title"><span>消息队列</span></li>
                        
                          <li><a title="JMS" href="15584265544434.html">JMS</a></li>
                        
                          <li><a title="RPC - RMI" href="15572232721703.html">RPC - RMI</a></li>
                        
                          <li><a title="消息队列" href="15560753193297.html">消息队列</a></li>
                        

                    
                      <li class="side-title"><span>分布式</span></li>
                        
                          <li><a title="概览" href="15630938148608.html">概览</a></li>
                        
                          <li><a title="分布式锁" href="15625959085058.html">分布式锁</a></li>
                        
                          <li><a title="分布式事务" href="15625700887049.html">分布式事务</a></li>
                        
                          <li><a title="ZooKeeper - 实现原理" href="15574104902395.html">ZooKeeper - 实现原理</a></li>
                        
                          <li><a title="ZK 分布式锁" href="15573683537890.html">ZK 分布式锁</a></li>
                        
                          <li><a title="ZooKeeper - 基本使用" href="15572415140464.html">ZooKeeper - 基本使用</a></li>
                        
                          <li><a title="Dubbo" href="15572232166193.html">Dubbo</a></li>
                        
                          <li><a title="分布式 - 一致性协议" href="15564260705049.html">分布式 - 一致性协议</a></li>
                        
                          <li><a title="ZooKeeper - ZAB 一致性协议" href="15561221442316.html">ZooKeeper - ZAB 一致性协议</a></li>
                        
                          <li><a title="分布式 - 理论" href="15559475613873.html">分布式 - 理论</a></li>
                        

                    
                      <li class="side-title"><span>LeetCode</span></li>
                        
                          <li><a title="栈" href="15641207902154.html">栈</a></li>
                        
                          <li><a title="链表" href="15640409436152.html">链表</a></li>
                        
                          <li><a title="位运算" href="15640226818030.html">位运算</a></li>
                        
                          <li><a title="树相关" href="15638876391543.html">树相关</a></li>
                        
                          <li><a title="并查集(union-find)" href="15637156793274.html">并查集(union-find)</a></li>
                        
                          <li><a title="图相关" href="15637123231485.html">图相关</a></li>
                        
                          <li><a title="动态规划 - 2" href="15637092754569.html">动态规划 - 2</a></li>
                        
                          <li><a title="其他" href="15632741408063.html">其他</a></li>
                        
                          <li><a title="动态规划 - 2" href="15621444826793.html">动态规划 - 2</a></li>
                        
                          <li><a title="字符串" href="15621426919335.html">字符串</a></li>
                        
                          <li><a title="贪心策略" href="15621379435201.html">贪心策略</a></li>
                        
                          <li><a title="动态规划 - 1" href="15618801162146.html">动态规划 - 1</a></li>
                        
                          <li><a title="回溯" href="15617108626739.html">回溯</a></li>
                        
                          <li><a title="组合博弈" href="15617105581442.html">组合博弈</a></li>
                        
                          <li><a title="temp" href="15600064978396.html">temp</a></li>
                        
                          <li><a title="筛选法" href="15600041568309.html">筛选法</a></li>
                        
                          <li><a title="Sell Stock" href="15592212071515.html">Sell Stock</a></li>
                        
                          <li><a title="dfs" href="15590119399452.html">dfs</a></li>
                        
                          <li><a title="Index" href="15578365171892.html">Index</a></li>
                        
                          <li><a title="排序" href="15578363359025.html">排序</a></li>
                        

                    
                      <li class="side-title"><span>算法</span></li>
                        
                          <li><a title="海量数据" href="15635229096880.html">海量数据</a></li>
                        
                          <li><a title="缓存" href="15616272119801.html">缓存</a></li>
                        
                          <li><a title="位操作" href="15421595266112.html">位操作</a></li>
                        
                          <li><a title="数据结构-搜索树" href="15382213735628.html">数据结构-搜索树</a></li>
                        
                          <li><a title="数据结构-查找" href="15381206652033.html">数据结构-查找</a></li>
                        
                          <li><a title="数据结构-栈与队列" href="15377961916563.html">数据结构-栈与队列</a></li>
                        
                          <li><a title="数据结构-树" href="15376956161325.html">数据结构-树</a></li>
                        
                          <li><a title="数据结构-图" href="15366535602244.html">数据结构-图</a></li>
                        
                          <li><a title="数据结构-排序" href="15366378611089.html">数据结构-排序</a></li>
                        
                          <li><a title="数据结构-线性表" href="15365715348624.html">数据结构-线性表</a></li>
                        
                          <li><a title="数据结构-绪论" href="15364817197942.html">数据结构-绪论</a></li>
                        
                          <li><a title="算法学习路径" href="15289789971496.html">算法学习路径</a></li>
                        

                    
                      <li class="side-title"><span>工具</span></li>
                        
                          <li><a title="MyBatis" href="15590240129274.html">MyBatis</a></li>
                        
                          <li><a title="Guava" href="15573643454153.html">Guava</a></li>
                        
                          <li><a title="Lombok" href="15571355421205.html">Lombok</a></li>
                        
                          <li><a title="IntelliJ-IDEA" href="15568897283887.html">IntelliJ-IDEA</a></li>
                        
                          <li><a title="Git" href="15568705670148.html">Git</a></li>
                        
                          <li><a title="Maven" href="15547227910617.html">Maven</a></li>
                        

                    
                      <li class="side-title"><span>网络</span></li>
                        
                          <li><a title="Netty" href="15633460791334.html">Netty</a></li>
                        
                          <li><a title="Http 授权" href="15629155221529.html">Http 授权</a></li>
                        
                          <li><a title="Https" href="15627233138405.html">Https</a></li>
                        
                          <li><a title="Http" href="15627233041942.html">Http</a></li>
                        
                          <li><a title="TCP" href="15627232889065.html">TCP</a></li>
                        
                          <li><a title="重要知识点" href="15561544288813.html">重要知识点</a></li>
                        

                    
                      <li class="side-title"><span>Linux</span></li>
                        
                          <li><a title="Linux - I/O 模型" href="15560816178760.html">Linux - I/O 模型</a></li>
                        
                          <li><a title="Linux" href="15556621779917.html">Linux</a></li>
                        

                    
                      <li class="side-title"><span>测试相关</span></li>
                        
                          <li><a title="Mockito" href="15590126556449.html">Mockito</a></li>
                        
                          <li><a title="测试相关" href="15587730878715.html">测试相关</a></li>
                        
                          <li><a title="JUnit" href="15579238927247.html">JUnit</a></li>
                        
                          <li><a title="测试" href="15579095305456.html">测试</a></li>
                        

                    
                      <li class="side-title"><span>Web</span></li>
                        
                          <li><a title="Http 缓存控制" href="15616231135862.html">Http 缓存控制</a></li>
                        
                          <li><a title="HTTP API 认证" href="15616218028083.html">HTTP API 认证</a></li>
                        

                    
                      <li class="side-title"><span>其他</span></li>
                        
                          <li><a title="计算机中的时间处理" href="15414917404912.html">计算机中的时间处理</a></li>
                        

                    
                  </ul>
                </nav>
                </div>
              </div>
            </div>
            <div class="large-9 medium-9 columns">

 <div class="markdown-body">
<h1>Mysql 深入</h1>

<ul>
<li>
<a href="#toc_0">Mysql 框架</a>
<ul>
<li>
<a href="#toc_1">日志</a>
</li>
</ul>
</li>
<li>
<a href="#toc_2">索引</a>
<ul>
<li>
<a href="#toc_3">实现</a>
</li>
<li>
<a href="#toc_4">InnoDB</a>
</li>
<li>
<a href="#toc_5">维护</a>
</li>
<li>
<a href="#toc_6">使用</a>
</li>
</ul>
</li>
<li>
<a href="#toc_7">事务</a>
<ul>
<li>
<a href="#toc_8">概念</a>
</li>
<li>
<a href="#toc_9">MVCC</a>
</li>
<li>
<a href="#toc_10">锁</a>
</li>
<li>
<a href="#toc_11">实现</a>
</li>
</ul>
</li>
<li>
<a href="#toc_12">参考</a>
</li>
</ul>


<h2 id="toc_0">Mysql 框架</h2>

<p><img src="media/15555007777074/15555008575910.jpg" alt=""/></p>

<p>主要分为两部分：</p>

<ul>
<li><strong>Server 层</strong>
<ul>
<li><strong>连接器</strong>，身份认证，打开连接等操作。</li>
<li><strong>缓存查询</strong>，基本弃用。</li>
<li><strong>分析器</strong>，对 SQL 进行词法与语法的分析。</li>
<li><strong>优化器</strong>，索引，多表查询等优化。</li>
<li><strong>执行器</strong>，调用引擎接口执行。</li>
</ul></li>
<li><strong>存储引擎</strong>，默认使用 InnoDB。</li>
</ul>

<h3 id="toc_1">日志</h3>

<p>有关日志，Mysql 有两个日志：</p>

<ol>
<li>bin log（归档日志）Mysql 自带。</li>
<li>redo log（重做日志）InnoDB 提供。</li>
</ol>

<p>如果每一次的更新操作都要写进磁盘，写进磁盘时又要查找记录对应的位置，那么对应的 IO 成本非常高。为了解决这个问题 Mysql 使用了 WAL (Write-Ahead Logging) 技术：<br/>
<strong>即先写日志，再写磁盘</strong>。<br/>
具体来说：</p>

<ol>
<li>当有一条记录需要更新时，InnoDB 就会先把记录写到 redo log，并更新内存，<strong>这样就算更新完毕了</strong>。</li>
<li>InnoDB 引擎会在适当的时候将这个操作记录更新到磁盘里面。</li>
<li>如果系统突然重启，记录还在 redo log 中并不会丢失。</li>
</ol>

<p>以具体语句说明一下执行流程：</p>

<p><code>update tb_student A set A.age=&#39;19&#39; where A.name=&#39; 张三 &#39;;</code></p>

<ol>
<li>查询到张三的记录。</li>
<li>内存中更新 age ，并记录 redo log</li>
<li>redo log 进入 prepare 状态</li>
<li>执行器记录 bin log，并使得 redo log 为 commit 状态</li>
<li>完成更新操作</li>
</ol>

<p>这里使用了<strong>两段式提交</strong>来保证数据的一致性。</p>

<h2 id="toc_2">索引</h2>

<p><img src="media/15555007777074/15559474727645.jpg" alt=""/></p>

<p>为什么要使用索引？</p>

<p>通过创建唯一性索引，可以保证数据库表中每一行数据的唯一性。<br/>
可以大大加快 数据的检索速度（大大减少的检索的数据量）, 这也是创建索引的最主要的原因。<br/>
帮助服务器避免排序和临时表<br/>
将随机IO变为顺序IO<br/>
可以加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义。<br/>
索引这么多优点，为什么不对表中的每一个列创建一个索引呢？</p>

<p>当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，这样就降低了数据的维护速度。<br/>
索引需要占物理空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果要建立聚簇索引，那么需要的空间就会更大。<br/>
创建索引和维护索引要耗费时间，这种时间随着数据量的增加而增加。<br/>
索引是如何提高查询速度的？</p>

<p>将无序的数据变成相对有序的数据（就像查目录一样）</p>

<p>说一下使用索引的注意事项</p>

<p>避免 where 子句中对字段施加函数，这会造成无法命中索引。<br/>
在使用InnoDB时使用与业务无关的自增主键作为主键，即使用逻辑主键，而不要使用业务主键。<br/>
将打算加索引的列设置为 NOT NULL ，否则将导致引擎放弃使用索引而进行全表扫描<br/>
删除长期未使用的索引，不用的索引的存在会造成不必要的性能损耗 MySQL 5.7 可以通过查询 sys 库的 schema_unused_indexes 视图来查询哪些索引从未被使用<br/>
在使用 limit offset 查询缓慢时，可以借助索引来提高性能</p>

<h3 id="toc_3">实现</h3>

<ol>
<li>哈希表，即使用拉链法维护一个哈希表来表示索引。
<ul>
<li>优点：
<ul>
<li>等值查询快，复杂度 O(1)</li>
</ul></li>
<li>缺点：
<ul>
<li>不适用于区间查找，复杂度 O(N)</li>
</ul></li>
<li>适应：
<ul>
<li><strong>只适用于只有等值查询的场景。</strong></li>
</ul></li>
</ul></li>
<li>有序数组，维护一个有序数组来维护索引。
<ul>
<li>优点：
<ul>
<li>等值查询和范围查询性能优秀，复杂度为 O(logN)</li>
</ul></li>
<li>缺点：
<ul>
<li>插入和删除非常慢，复杂度为 O(N)</li>
</ul></li>
<li>适用
<ul>
<li><strong>只适用于静态存储引擎</strong></li>
</ul></li>
</ul></li>
<li>B+ 树，使用 B+ 树来维护索引。
<ul>
<li>优点：</li>
<li>读写上有性能优势，且适配磁盘的访问模式。</li>
</ul></li>
</ol>

<p>B+ 树是一般数据库的索引模式</p>

<h3 id="toc_4">InnoDB</h3>

<p><strong>在 InnoDB 中每一个索引对应一棵 B+ 树。</strong></p>

<p>假设有一个建表语句：</p>

<pre class="line-numbers"><code class="language-sql">mysql&gt; create table T( 
       id int primary key,
       k int not null,
       name varchar(16),
       index (k))engine=InnoDB;
</code></pre>

<p>其中 R1~R5 的 (ID,k) 值分别为 (100,1)、(200,2)、(300,3)、(500,5) 和 (600,6)，两棵树的示例示意图如下：<br/>
<img src="media/15555624850596/15556524371474.jpg" alt=""/></p>

<p>根据叶子节点的内容可以看出索引分为两类：</p>

<ul>
<li><strong>主键索引</strong>(clustered index)，也叫聚簇索引。
<ul>
<li>如果执行 <code>select * from T where ID=500</code> 即主键查询方式。</li>
<li>只需要搜索 ID 这棵 B+ 树。</li>
</ul></li>
<li><strong>非主键索引</strong>(secondary index)，也叫二级索引。
<ul>
<li>如果执行 <code>select * from T where k=5</code>，即普通索引查询方式。</li>
<li>需要先搜索 k 索引 树，得到 ID 的值为 500，再到 ID 索引树搜索一次。</li>
<li>上面这个过程称为<strong>回表</strong>。</li>
</ul></li>
</ul>

<h3 id="toc_5">维护</h3>

<p>当插入删除等操作发生时，B+ 树为了维护索引的有序性会发生：</p>

<ul>
<li><strong>页分裂</strong>，即插入数据后，数据页已满需要把页分裂。
<ul>
<li>会导致性能降低也，会导致空间利用率下降。</li>
</ul></li>
<li><strong>页合并</strong>，即删除数据后，发生的数据页合并。</li>
</ul>

<p>这里即引出了一个问题，为什么主键的定义一般是：<br/>
<code>NOT NULL PRIMARY KEY AUTO_INCREMENT</code><br/>
有几个优点：</p>

<ul>
<li>不会页分裂和页合并的操作，<strong>性能最好</strong>。</li>
<li>主键长度最小化，<strong>占用空间小</strong>。</li>
</ul>

<p>只有一种场景是是适合使用业务字段做主键的：</p>

<ol>
<li>只有一个索引。</li>
<li>该索引必须是唯一索引。</li>
</ol>

<p>即 KV 场景。</p>

<h3 id="toc_6">使用</h3>

<p><strong>覆盖索引</strong><br/>
由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用 的性能优化手段。</p>

<p><strong>最左前缀原则</strong></p>

<p>第一原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的。</p>

<p><strong>索引下推</strong></p>

<h2 id="toc_7">事务</h2>

<h3 id="toc_8">概念</h3>

<p><img src="media/15555007777074/15555064272132.jpg" alt="" style="width:349px;"/></p>

<p>注意这里的三个值 v1, v2, v3 在不同的隔离情况下讨论：</p>

<ol>
<li><strong>读未提交 (read uncommitted)</strong>
<ul>
<li>v1=v2=v3=2</li>
<li>显然，读 v1 时虽然没提交但是已经被事务 A 看到了。</li>
</ul></li>
<li><strong>读提交 (read committed)</strong>
<ul>
<li>v1=1, v2=v3=2</li>
<li>B 事务中对值的修改对 A 事务不可见。</li>
</ul></li>
<li><strong>可重复读 (repeatable read)</strong>
<ul>
<li>v1=v2=1, v3=2</li>
<li>事务执行前后数据要一致。</li>
</ul></li>
<li><strong>串行化 (serializable)</strong>
<ul>
<li>v1=v2=1, v3=2</li>
<li>修改时会锁，直到事务提交。</li>
</ul></li>
</ol>

<p><strong>mysql 默认的隔离级别为可重复读</strong>。</p>

<h3 id="toc_9">MVCC</h3>

<p>Mysql 使用了 MVCC 解决<strong>读写冲突</strong>问题。<br/>
MVCC 是在记录中维护几个隐藏字段来实现的。</p>

<p><img src="media/15555007777074/15559214865713.png" alt=""/></p>

<ul>
<li><code>DB_ROW_ID</code>：包含一个随着新行插入而单调递增的行ID, 当由innodb自动产生聚集索引时，聚集索引会包括这个行ID的值，否则这个行ID不会出现在任何索引中。</li>
<li><code>DB_TRX_ID</code>：用来标识最近一次对本行记录做修改的事务的标识符，即最后一次修改本行记录的事务id。delete操作在内部来看是一次update操作，更新行中的删除标识位DELELE_BIT。</li>
<li><code>DB_ROLL_PTR</code>：指向当前数据的undo log记录，回滚数据通过这个指针来寻找记录被更新之前的内容信息。</li>
<li><code>DELELE_BIT</code>：用于标识该记录是否被删除。</li>
</ul>

<p>对应的数据操作：</p>

<ul>
<li>insert 
<ul>
<li>创建一条记录</li>
<li>DB_TRX_ID 为当前事务ID</li>
<li>DB_ROLL_PTR 为 NULL</li>
</ul></li>
<li>delete
<ul>
<li>对当前行的操作</li>
<li>DB_TRX_ID 为当前事务ID</li>
<li>DELELE_BIT 为1</li>
</ul></li>
<li>update
<ul>
<li>复制一行</li>
<li>新行的DB_TRX_ID为当前事务ID</li>
<li>DB_ROLL_PTR指向上个版本的记录</li>
<li>事务提交后DB_ROLL_PTR设置为NULL</li>
</ul></li>
<li>select
<ol>
<li>只查找创建早于当前事务ID的记录，确保当前事务读取到的行都是事务之前就已经存在的，或者是由当前事务创建或修改的</li>
<li>行的DELETE BIT为1时，查找删除晚于当前事务ID的记录，确保当前事务开始之前，行没有被删除。</li>
</ol></li>
</ul>

<p>这里还有一个重要的概念就是：<strong>read view</strong><br/>
read view 维护一个 low_limit_id 值。即<strong>当前系统尚未分配的下一个事务ID或目前已经出现过的事务ID的最大值+1</strong><br/>
读提交和重复读隔离级别下，读操作会看不见 trx id &gt;= low_limit_id 的事务。</p>

<h3 id="toc_10">锁</h3>

<ol>
<li><strong>全局锁</strong> 
*<code>Flush tables with read lock</code>(FTWRL) 全局读锁
<ul>
<li>一般在全库逻辑备份时使用，即将所有表都 Select 出来存为文件</li>
</ul></li>
<li><strong>表级锁</strong>，表锁一般是在数据库引擎不支持行锁的时候才会被用到的
<ul>
<li><code>lock tables … read/write</code> 加锁， <code>unlock tables</code> 解锁</li>
</ul></li>
<li><strong>元数据锁，表级锁的另一种形式</strong> MDL（metadata lock) <strong>不需要显式使用</strong>，会在访问表时自动加上，触发条件：
<ul>
<li>表做增删改查操作的时候，加 MDL 读锁</li>
<li>对表做结构变更操作的时候，加 MDL 写锁</li>
</ul></li>
<li><strong>行级锁</strong>
<ul>
<li>在 InnoDB 事务中，行锁是在需要的时候才加上的，但并不是不需要了就立刻 释放，而是要等到事务结束时才释放。这个就是两阶段锁协议。</li>
<li>如果你的事务中需要锁多个 行，要把最可能造成锁冲突、最可能影响并发度的锁尽量往后放。</li>
</ul></li>
</ol>

<h3 id="toc_11">实现</h3>

<p>所以索引的具体实现方式为：</p>

<ol>
<li>读未提交
<ul>
<li>无</li>
</ul></li>
<li>读提交，使用 MVCC
<ul>
<li>read view是在执行<strong>事务中第一条select语句的瞬间创</strong>建，后续所有的select都是复用这个对象，所以能保证每次读取的一致性。</li>
</ul></li>
<li>重复读，使用 MVCC，区别在于
<ul>
<li>事务中<strong>每条select语句都会创建read view</strong>，这样就可以读取到其它事务已经提交的内容。</li>
</ul></li>
<li>串行
<ul>
<li>各种锁</li>
</ul></li>
</ol>

<h2 id="toc_12">参考</h2>

<ol>
<li><a href="https://snailclimb.top/JavaGuide/#/./database/MySQL%20Index">思维导图-索引篇</a></li>
<li><a href="https://time.geekbang.org/column/intro/139">MySQL实战45讲</a></li>
<li><a href="https://juejin.im/post/5c519bb8f265da617831cfff">数据库事务和MVCC多版本并发控制</a></li>
<li><a href="https://www.zhihu.com/question/27876575">乐观锁和 MVCC 的区别？</a></li>
</ol>


</div>

<br /><br />
<hr />

<div class="row clearfix">
  <div class="large-6 columns">
	<div class="text-left" style="padding:15px 0px;">
		
	        <a href="15555575014317.html"  title="Previous Post: Java - Servlet">&laquo; Java - Servlet</a>
	    
	</div>
  </div>
  <div class="large-6 columns">
	<div class="text-right" style="padding:15px 0px;">
		
	        <a href="15554985061309.html" 
	        title="Next Post: Mysql 基本使用">Mysql 基本使用 &raquo;</a>
	    
	</div>
  </div>
</div>

<div class="row">
<div style="padding:0px 0.93em;" class="share-comments">

</div>
</div>
<script type="text/javascript">
	$(function(){
		var currentURL = '15555007777074.html';
		$('#side-nav a').each(function(){
			if($(this).attr('href') == currentURL){
				$(this).parent().addClass('active');
			}
		});
	});
</script>  
</div></div>


<div class="page-bottom">
  <div class="row">
  <hr />
  <div class="small-9 columns">
  <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
  <div class="small-3 columns">
  <p class="copyright text-right"><a href="#header">TOP</a></p>
  </div>
   
  </div>
</div>

        </section>
      </div>
    </div>
    
    
    <script src="asset/js/foundation.min.js"></script>
    <script src="asset/js/foundation/foundation.offcanvas.js"></script>
    <script>
      $(document).foundation();

     
    </script>
    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>

  </body>
</html>
